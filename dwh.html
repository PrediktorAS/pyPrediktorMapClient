<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Working with the Data Warehouse &mdash; pyPrediktorMapClient 0.6.5 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=d7a12d57"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="pyprediktormapclient" href="api/modules.html" />
    <link rel="prev" title="Contributors" href="authors.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            pyPrediktorMapClient
          </a>
              <div class="version">
                0.6.5
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="readme.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributions &amp; Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Authors</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Working with Data Warehouse</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/modules.html">Module Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pyPrediktorMapClient</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Working with the Data Warehouse</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/dwh.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="working-with-the-data-warehouse">
<span id="dwh"></span><h1>Working with the Data Warehouse<a class="headerlink" href="#working-with-the-data-warehouse" title="Link to this heading"></a></h1>
<p>The Data Warehouse in PowerView is a database that gathers data from various
sources and stores it in a format that is optimized for reporting.  Some of the
data within the Data Warehouse is updated on a regular basis, while other data
can be generated withing the Data Warehouse itself (such as KPIs).</p>
<p>The Data Warehouse is a Microsoft SQL database. To interface with the Data from
python, we use the <a href="#id1"><span class="problematic" id="id2">`pyodbc`_</span></a> library.  This library allows us to connect to the
Data Warehouse and execute SQL queries, but this means that you can use the
functionality provided in this library to connect to any SQL database, e.g. the
“Model Results” database.</p>
<p>## pyodbc and drivers</p>
<p>The <a href="#id3"><span class="problematic" id="id4">`pyodbc`_</span></a> library is a python library that allows you to connect to SQL
databases.  However, it does not provide the drivers that are needed to connect
to the databases.  The drivers are provided by the database vendors and must be
installed separately.  For example, to connect to the Data Warehouse, you need
to install the Microsoft SQL Server ODBC Driver. This driver is available for
download from the Microsoft website as descibed (here)[<a class="reference external" href="https://learn.microsoft.com/en-us/sql/connect/python/pyodbc/step-1-configure-development-environment-for-pyodbc-python-development?view=sql-server-ver16&amp;tabs=macos">https://learn.microsoft.com/en-us/sql/connect/python/pyodbc/step-1-configure-development-environment-for-pyodbc-python-development?view=sql-server-ver16&amp;tabs=macos</a>].</p>
<p>When you initiate the <cite>DWH</cite> class, it will automatically try to connect using
the first driver that it finds.  If you have multiple drivers installed, you
can specify which driver to use by passing the <cite>driver</cite> argument to the <cite>DWH</cite>
as an input argument (integer). If you are not certain of the driver number,
you can use the <cite>list_drivers</cite> method to list all the drivers that are
available on your system, but only after you have initiated the <cite>DWH</cite> class.</p>
<p>## Connecting to the Data Warehouse</p>
<p>To connect to the Data Warehouse, you need to know the name of the server and
the database, as well as your username and password.  These are all provided
to you by the PowerView team.  Once you have this information, you can connect
by initating the <cite>DWH</cite> class like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyprediktormapclient.dwh</span> <span class="kn">import</span> <span class="n">DWH</span>
<span class="n">dwh</span> <span class="o">=</span> <span class="n">DWH</span><span class="p">(</span><span class="n">server</span><span class="o">=</span><span class="s1">&#39;server_name&#39;</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="s1">&#39;database_name&#39;</span><span class="p">,</span>
          <span class="n">username</span><span class="o">=</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;password&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <cite>DWH</cite> class has a <cite>connect</cite> method that will automatically connect to the
database when you initiate the class and the other functions within the class
will reconnect if the connection is lost. The <cite>DWH</cite> class also has a <cite>disconnect</cite>
method that will close the connection to the database, also automatically run with
the <cite>__exit__</cite> method.</p>
<p>The object returned by the <cite>DWH</cite> class is a <cite>pyodbc.Connection</cite> object, so you
can use any of the methods provided by that class.  For example, you can use
the <cite>cursor</cite> method to create a cursor object that can be used to execute SQL
or anythign else as (documented in the official project)[<a class="reference external" href="https://github.com/mkleehammer/pyodbc/wiki">https://github.com/mkleehammer/pyodbc/wiki</a>].</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cursor</span> <span class="o">=</span> <span class="n">dwh</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM dbo.DimDate&#39;</span><span class="p">)</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</div>
<p>## Getting Data from the Data Warehouse</p>
<p>The <cite>DWH</cite> class has a number of methods that can be used to read and write data
from/to the Data Warehouse. These methods are documented in the API reference, but
here are some examples of how to use them.</p>
<p>### Reading Data</p>
<p>The <cite>DWH</cite> class has a <cite>read</cite> method that can be used to read data from the Data
Warehouse.  This method takes a SQL query as a string and returns the result as
a list with all the results. If you want to read the data into a pandas DataFrame,
you can use the <cite>read_to_dataframe</cite> method, which will return a pandas DataFrame.
Also, if you want to read the result line by line, you can use the call the cursor
method directly and iterate over the results with <cite>fetchone</cite> from <cite>pyodbc</cite>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read data into a list</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">dwh</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM dbo.DimDate&#39;</span><span class="p">)</span>

<span class="c1"># Read data into a pandas DataFrame</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">dwh</span><span class="o">.</span><span class="n">read_to_dataframe</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM dbo.DimDate&#39;</span><span class="p">)</span>

<span class="c1"># Read data line by line</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">dwh</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT * FROM dbo.DimDate&#39;</span><span class="p">)</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">row</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">row</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</pre></div>
</div>
<p>### Writing Data</p>
<p>The <cite>DWH</cite> class has a <cite>write</cite> method that can be used to write data to the Data
Warehouse.  This method takes a SQL query as a string and executes it.  If you
add the <cite>commit=True</cite> argument, the changes will be committed to the database
or rolled back if an error occurs. Alternatively, you can use the <cite>commit</cite> method
to commit the changes to the database. Failing to commit the changes will result
in the changes being lost.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Write data to the database and commit the changes</span>
<span class="n">dwh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;INSERT INTO dbo.DimDate VALUES (</span><span class="se">\&#39;</span><span class="s1">2018-01-01</span><span class="se">\&#39;</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># or in two steps that would potentially allow you to read the data before</span>
<span class="c1"># committing the changes</span>
<span class="n">dwh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;INSERT INTO dbo.DimDate VALUES (</span><span class="se">\&#39;</span><span class="s1">2018-01-01</span><span class="se">\&#39;</span><span class="s1">)&#39;</span><span class="p">)</span>
<span class="n">dwh</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="authors.html" class="btn btn-neutral float-left" title="Contributors" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="api/modules.html" class="btn btn-neutral float-right" title="pyprediktormapclient" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Prediktor Support.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>